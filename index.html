<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Калькулятор прибыли по перепродаже</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 650px;
      margin: 15px auto;
      padding: 15px;
      background-color: #f9f9f9;
    }
    .form-group {
      margin-bottom: 12px;
    }
    label {
      display: block;
      margin-bottom: 4px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
    }
    .button-group {
      display: flex;
      gap: 10px;
      margin: 12px 0;
    }
    .button-group button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    #addBtn { background-color: #4caf50; color: white; }
    #addBtn:hover { background-color: #45a049; }
    #clearFormBtn { background-color: #ff9800; color: white; }
    #clearFormBtn:hover { background-color: #f57c00; }
    
    .report-section {
      margin-top: 25px;
      background: white;
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
    .period-header {
      font-size: 1.1em;
      margin: 12px 0 8px;
      padding-bottom: 5px;
      border-bottom: 1px solid #eee;
    }
    .summary {
      margin-top: 8px;
      font-weight: bold;
    }
    .clear-btn {
      background-color: #f44336;
      color: white;
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    .clear-btn:hover { background-color: #d32f2f; }
    .item {
      font-size: 0.95em;
      padding: 5px 0;
      color: #555;
    }
    .buy { color: #2e7d32; }
    .sell { color: #c62828; }
  </style>
</head>
<body>

  <h1>Калькулятор прибыли по перепродаже</h1>

  <div class="form-group">
    <label>Тип операции:</label>
    <select id="operationType">
      <option value="buy">Покупка</option>
      <option value="sell">Продажа</option>
    </select>
  </div>

  <div class="form-group">
    <label for="itemName">Название вещи:</label>
    <input type="text" id="itemName" placeholder="Например: Меч Легенды">
  </div>

  <div class="form-group">
    <label for="itemPrice">Цена за штуку:</label>
    <input type="number" id="itemPrice" step="0.01" min="0" placeholder="150.50">
  </div>

  <div class="form-group">
    <label for="itemQuantity">Количество:</label>
    <input type="number" id="itemQuantity" min="1" placeholder="10">
  </div>

  <div class="button-group">
    <button id="addBtn" onclick="addTransaction()">Добавить</button>
    <button id="clearFormBtn" onclick="clearForm()">Очистить форму</button>
  </div>

  <div class="report-section">
    <h2>Отчёты</h2>
    <div id="reportsContainer"></div>
  </div>

  <button class="clear-btn" onclick="clearAllData()">Очистить ВСЕ данные</button>

  <script>
    // Вспомогательные функции даты
    function today() {
      return new Date().toISOString().split('T')[0]; // "2025-11-03"
    }
    function getDateDaysAgo(days) {
      const d = new Date();
      d.setDate(d.getDate() - days);
      return d.toISOString().split('T')[0];
    }
    function getWeekStart() {
      const d = new Date();
      const day = d.getDay() || 7;
      d.setDate(d.getDate() - (day - 1)); // понедельник текущей недели
      return d.toISOString().split('T')[0];
    }
    function getMonthStart() {
      const d = new Date();
      return new Date(d.getFullYear(), d.getMonth(), 1).toISOString().split('T')[0];
    }

    // Загрузка данных
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

    function addTransaction() {
      const type = document.getElementById('operationType').value;
      const name = document.getElementById('itemName').value.trim();
      const priceStr = document.getElementById('itemPrice').value;
      const quantityStr = document.getElementById('itemQuantity').value;

      if (!name) { alert("Укажите название."); return; }
      const price = parseFloat(priceStr);
      const quantity = parseInt(quantityStr);
      if (isNaN(price) || price < 0) { alert("Некорректная цена."); return; }
      if (isNaN(quantity) || quantity < 1) { alert("Некорректное количество."); return; }

      const total = price * quantity;
      const date = today();

      transactions.push({ type, name, price, quantity, total, date });
      localStorage.setItem('transactions', JSON.stringify(transactions));

      // Фокус на количестве для быстрого повтора
      document.getElementById('itemQuantity').select();
      document.getElementById('itemQuantity').focus();

      renderReports();
    }

    function clearForm() {
      document.getElementById('itemName').value = '';
      document.getElementById('itemPrice').value = '';
      document.getElementById('itemQuantity').value = '';
      document.getElementById('operationType').value = 'buy';
      document.getElementById('itemName').focus();
    }

    // Фильтрация транзакций по диапазону дат
    function filterByDateRange(startDate, endDate = today()) {
      return transactions.filter(t => t.date >= startDate && t.date <= endDate);
    }

    // Генерация отчёта по списку транзакций
    function generateReport(transactions, title) {
      if (transactions.length === 0) return '';

      let spent = 0; // потрачено (покупки)
      let earned = 0; // выручено (продажи)
      let itemsHtml = '';

      transactions.forEach(t => {
        const className = t.type === 'buy' ? 'buy' : 'sell';
        const sign = t.type === 'buy' ? '–' : '+';
        itemsHtml += `<div class="item ${className}">${sign} ${t.name} ×${t.quantity} по ${t.price.toFixed(2)} = ${t.total.toFixed(2)} (${t.date})</div>`;

        if (t.type === 'buy') spent += t.total;
        if (t.type === 'sell') earned += t.total;
      });

      const profit = earned - spent;
      const profitColor = profit >= 0 ? '#2e7d32' : '#c62828';

      return `
        <div class="period-header">${title}</div>
        <div>${itemsHtml}</div>
        <div class="summary">
          Потрачено: <strong>${spent.toFixed(2)}</strong> | 
          Выручка: <strong>${earned.toFixed(2)}</strong> | 
          Прибыль: <strong style="color:${profitColor}">${profit >= 0 ? '+' : ''}${profit.toFixed(2)}</strong>
        </div>
      `;
    }

    function renderReports() {
      const container = document.getElementById('reportsContainer');

      const todayTx = filterByDateRange(today());
      const yesterdayTx = filterByDateRange(getDateDaysAgo(1), getDateDaysAgo(1));
      const weekTx = filterByDateRange(getWeekStart());
      const monthTx = filterByDateRange(getMonthStart());

      let html = '';
      html += generateReport(todayTx, 'Сегодня');
      html += generateReport(yesterdayTx, 'Вчера');
      html += generateReport(weekTx, 'Эта неделя');
      html += generateReport(monthTx, 'Этот месяц');

      if (!html) html = '<p>Нет данных</p>';
      container.innerHTML = html;
    }

    function clearAllData() {
      if (confirm("Очистить ВСЕ данные навсегда?")) {
        transactions = [];
        localStorage.removeItem('transactions');
        renderReports();
      }
    }

    // Инициализация
    renderReports();
  </script>

</body>
</html>
