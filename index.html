<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ü–µ—Ä–µ–ø—Ä–æ–¥–∞–∂–∞: –†–∞—Å—á—ë—Ç + –û—Ç—á—ë—Ç</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 15px auto;
      padding: 15px;
      background-color: #f9f9f9;
    }

    .columns {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .column {
      flex: 1;
      min-width: 300px;
      background: white;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .buy-column { border-top: 4px solid #2e7d32; }
    .sell-column { border-top: 4px solid #c62828; }

    .column h3 {
      margin-top: 0;
      color: #333;
    }
    .buy-column h3 { color: #2e7d32; }
    .sell-column h3 { color: #c62828; }

    .form-group {
      margin-bottom: 12px;
    }
    label {
      display: block;
      margin-bottom: 4px;
      font-weight: bold;
      font-size: 0.95em;
    }
    input {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .preview {
      margin: 12px 0;
      padding: 10px;
      background-color: #f5f5f5;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
    }
    .preview-buy { color: #2e7d32; }
    .preview-sell { color: #c62828; }

    .btn {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 6px;
    }
    .btn-save { background-color: #1976d2; color: white; }
    .btn-clear { background-color: #ff9800; color: white; }
    .btn:hover { opacity: 0.9; }

    .report-section {
      margin-top: 25px;
      background: white;
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
    .period-header {
      font-size: 1.1em;
      margin: 12px 0 8px;
      padding-bottom: 5px;
      border-bottom: 1px solid #eee;
    }
    .summary {
      margin-top: 8px;
      font-weight: bold;
    }
    .item {
      font-size: 0.92em;
      padding: 4px 0;
      color: #555;
    }
    .buy-item { color: #2e7d32; }
    .sell-item { color: #c62828; }

    .clear-all-btn {
      background-color: #f44336;
      color: white;
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 15px;
    }
  </style>
</head>
<body>

  <h1>üìä –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–∂–∞: –†–∞—Å—á—ë—Ç ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –û—Ç—á—ë—Ç</h1>

  <div class="columns">
    <!-- –ü–û–ö–£–ü–ö–ò -->
    <div class="column buy-column">
      <h3>üõí –°–∫—É–ø–∫–∞</h3>
      <div class="form-group">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
        <input type="text" id="buyName" placeholder="–ú–µ—á –õ–µ–≥–µ–Ω–¥—ã" oninput="updatePreview('buy')">
      </div>
      <div class="form-group">
        <label>–¶–µ–Ω–∞ –∑–∞ —à—Ç—É–∫—É:</label>
        <input type="number" id="buyPrice" step="0.01" min="0" placeholder="150.50" oninput="updatePreview('buy')">
      </div>
      <div class="form-group">
        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
        <input type="number" id="buyQty" min="1" placeholder="10" oninput="updatePreview('buy')">
      </div>
      <div class="preview preview-buy" id="buyPreview">–ò—Ç–æ–≥–æ: 0.00</div>
      <button class="btn btn-save" onclick="saveBuy()">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–∫—É–ø–∫—É –≤ –æ—Ç—á—ë—Ç</button>
      <button class="btn btn-clear" onclick="clearBuyForm()">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
    </div>

    <!-- –ü–†–û–î–ê–ñ–ò -->
    <div class="column sell-column">
      <h3>üí∞ –ü—Ä–æ–¥–∞–∂–∞</h3>
      <div class="form-group">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
        <input type="text" id="sellName" placeholder="–ú–µ—á –õ–µ–≥–µ–Ω–¥—ã" oninput="updatePreview('sell')">
      </div>
      <div class="form-group">
        <label>–¶–µ–Ω–∞ –∑–∞ —à—Ç—É–∫—É:</label>
        <input type="number" id="sellPrice" step="0.01" min="0" placeholder="180.00" oninput="updatePreview('sell')">
      </div>
      <div class="form-group">
        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
        <input type="number" id="sellQty" min="1" placeholder="8" oninput="updatePreview('sell')">
      </div>
      <div class="preview preview-sell" id="sellPreview">–ò—Ç–æ–≥–æ: 0.00</div>
      <button class="btn btn-save" onclick="saveSell()">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É –≤ –æ—Ç—á—ë—Ç</button>
      <button class="btn btn-clear" onclick="clearSellForm()">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
    </div>
  </div>

  <div class="report-section">
    <h2>üìà –û—Ç—á—ë—Ç—ã –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º</h2>
    <div id="reportsContainer"></div>
  </div>

  <button class="clear-all-btn" onclick="clearAllData()">–û—á–∏—Å—Ç–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ (–Ω–æ–≤—ã–π –¥–µ–Ω—å)</button>

  <script>
    // –î–∞—Ç–∞ —Å–µ–≥–æ–¥–Ω—è
    function today() {
      return new Date().toISOString().split('T')[0];
    }
    function getDateDaysAgo(days) {
      const d = new Date();
      d.setDate(d.getDate() - days);
      return d.toISOString().split('T')[0];
    }
    function getWeekStart() {
      const d = new Date();
      const day = d.getDay() || 7;
      d.setDate(d.getDate() - (day - 1));
      return d.toISOString().split('T')[0];
    }
    function getMonthStart() {
      const d = new Date();
      return new Date(d.getFullYear(), d.getMonth(), 1).toISOString().split('T')[0];
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

    // –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
    function updatePreview(type) {
      const prefix = type === 'buy' ? 'buy' : 'sell';
      const name = document.getElementById(prefix + 'Name').value.trim();
      const price = parseFloat(document.getElementById(prefix + 'Price').value) || 0;
      const qty = parseInt(document.getElementById(prefix + 'Qty').value) || 0;
      const total = price * qty;

      document.getElementById(prefix + 'Preview').textContent = name 
        ? `–ò—Ç–æ–≥–æ: ${total.toFixed(2)}` 
        : '–ò—Ç–æ–≥–æ: 0.00';
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
    function saveBuy() {
      const name = document.getElementById('buyName').value.trim();
      const price = parseFloat(document.getElementById('buyPrice').value);
      const qty = parseInt(document.getElementById('buyQty').value);

      if (!name) { alert("–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ."); return; }
      if (isNaN(price) || price < 0) { alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞."); return; }
      if (isNaN(qty) || qty < 1) { alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ."); return; }

      const total = price * qty;
      transactions.push({ type: 'buy', name, price, quantity: qty, total, date: today() });
      localStorage.setItem('transactions', JSON.stringify(transactions));

      // –ù–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É ‚Äî —Ç–æ–ª—å–∫–æ —Ñ–æ–∫—É—Å –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ
      document.getElementById('buyQty').select();
      document.getElementById('buyQty').focus();

      renderReports();
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏
    function saveSell() {
      const name = document.getElementById('sellName').value.trim();
      const price = parseFloat(document.getElementById('sellPrice').value);
      const qty = parseInt(document.getElementById('sellQty').value);

      if (!name) { alert("–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ."); return; }
      if (isNaN(price) || price < 0) { alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞."); return; }
      if (isNaN(qty) || qty < 1) { alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ."); return; }

      const total = price * qty;
      transactions.push({ type: 'sell', name, price, quantity: qty, total, date: today() });
      localStorage.setItem('transactions', JSON.stringify(transactions));

      document.getElementById('sellQty').select();
      document.getElementById('sellQty').focus();

      renderReports();
    }

    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º
    function clearBuyForm() {
      document.getElementById('buyName').value = '';
      document.getElementById('buyPrice').value = '';
      document.getElementById('buyQty').value = '';
      updatePreview('buy');
      document.getElementById('buyName').focus();
    }
    function clearSellForm() {
      document.getElementById('sellName').value = '';
      document.getElementById('sellPrice').value = '';
      document.getElementById('sellQty').value = '';
      updatePreview('sell');
      document.getElementById('sellName').focus();
    }

    // –û—Ç—á—ë—Ç—ã
    function filterByDateRange(startDate, endDate = today()) {
      return transactions.filter(t => t.date >= startDate && t.date <= endDate);
    }

    function generateReport(transactions, title) {
      if (transactions.length === 0) return '';

      let spent = 0, earned = 0;
      let itemsHtml = '';

      transactions.forEach(t => {
        const className = t.type === 'buy' ? 'buy-item' : 'sell-item';
        const sign = t.type === 'buy' ? '‚Äì' : '+';
        itemsHtml += `<div class="item ${className}">${sign} ${t.name} √ó${t.quantity} –ø–æ ${t.price.toFixed(2)} = ${t.total.toFixed(2)} (${t.date})</div>`;
        if (t.type === 'buy') spent += t.total;
        if (t.type === 'sell') earned += t.total;
      });

      const profit = earned - spent;
      const profitColor = profit >= 0 ? '#2e7d32' : '#c62828';

      return `
        <div class="period-header">${title}</div>
        <div>${itemsHtml}</div>
        <div class="summary">
          –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: <strong>${spent.toFixed(2)}</strong> | 
          –í—ã—Ä—É—á–∫–∞: <strong>${earned.toFixed(2)}</strong> | 
          –ü—Ä–∏–±—ã–ª—å: <strong style="color:${profitColor}">${profit >= 0 ? '+' : ''}${profit.toFixed(2)}</strong>
        </div>
      `;
    }

    function renderReports() {
      const container = document.getElementById('reportsContainer');

      const todayTx = filterByDateRange(today());
      const yesterdayTx = filterByDateRange(getDateDaysAgo(1), getDateDaysAgo(1));
      const weekTx = filterByDateRange(getWeekStart());
      const monthTx = filterByDateRange(getMonthStart());

      let html = '';
      html += generateReport(todayTx, '–°–µ–≥–æ–¥–Ω—è');
      html += generateReport(yesterdayTx, '–í—á–µ—Ä–∞');
      html += generateReport(weekTx, '–≠—Ç–∞ –Ω–µ–¥–µ–ª—è');
      html += generateReport(monthTx, '–≠—Ç–æ—Ç –º–µ—Å—è—Ü');

      container.innerHTML = html || '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
    }

    function clearAllData() {
      if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –Ω–∞—á–Ω—ë—Ç –Ω–æ–≤—ã–π –¥–µ–Ω—å.")) {
        transactions = [];
        localStorage.removeItem('transactions');
        renderReports();
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updatePreview('buy');
    updatePreview('sell');
    renderReports();
  </script>

</body>
</html>
